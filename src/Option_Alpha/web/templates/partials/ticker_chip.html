<div class="relative" x-data="{ showPopover: false }">
  <button @click="showPopover = !showPopover" @click.outside="showPopover = false"
          class="inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium
                 transition-colors cursor-pointer
                 {% if ticker.status == 'active' %}
                 bg-zinc-800 border border-zinc-700 text-zinc-200 hover:border-zinc-600 hover:text-zinc-100
                 {% else %}
                 bg-zinc-800/50 border border-zinc-700/50 text-zinc-500 hover:border-zinc-600/50
                 {% endif %}">
    <span>{{ ticker.symbol }}</span>
    {% if ticker.market_cap_tier == 'large_cap' %}
    <span class="w-1.5 h-1.5 rounded-full bg-emerald-400" title="Large Cap"></span>
    {% elif ticker.market_cap_tier == 'etf' %}
    <span class="w-1.5 h-1.5 rounded-full bg-blue-400" title="ETF"></span>
    {% elif ticker.market_cap_tier == 'mid_cap' %}
    <span class="w-1.5 h-1.5 rounded-full bg-amber-400" title="Mid Cap"></span>
    {% elif ticker.market_cap_tier == 'small_cap' %}
    <span class="w-1.5 h-1.5 rounded-full bg-zinc-400" title="Small Cap"></span>
    {% endif %}
  </button>

  <!-- Popover -->
  <div x-show="showPopover" x-transition
       class="absolute z-50 mt-1 left-0 w-56 bg-zinc-800 border border-zinc-700 rounded-lg
              shadow-xl p-3 space-y-2">
    <div class="flex items-center justify-between">
      <span class="font-semibold text-sm text-zinc-100">{{ ticker.symbol }}</span>
      <span class="text-xs px-1.5 py-0.5 rounded
                   {% if ticker.status == 'active' %}bg-emerald-900/50 text-emerald-400
                   {% else %}bg-zinc-700 text-zinc-400{% endif %}">
        {{ ticker.status }}
      </span>
    </div>
    <p class="text-xs text-zinc-400 truncate" title="{{ ticker.name }}">{{ ticker.name }}</p>
    <div class="grid grid-cols-2 gap-1 text-xs">
      <span class="text-zinc-500">Tier:</span>
      <span class="text-zinc-300">{{ ticker.market_cap_tier | replace('_', ' ') | title }}</span>
      <span class="text-zinc-500">Source:</span>
      <span class="text-zinc-300">{{ ticker.source }}</span>
      <span class="text-zinc-500">Type:</span>
      <span class="text-zinc-300">{{ ticker.asset_type | title }}</span>
    </div>
    <div class="flex gap-2 pt-1 border-t border-zinc-700">
      <a hx-get="/debate/{{ ticker.symbol }}" hx-target="#main-content" hx-push-url="true"
         class="flex-1 text-center px-2 py-1 text-xs bg-emerald-600 hover:bg-emerald-500
                text-white rounded transition-colors cursor-pointer">
        Debate
      </a>
      {% if watchlists %}
      <div class="relative flex-1" x-data="{ showWl: false }">
        <button @click.stop="showWl = !showWl"
                class="w-full px-2 py-1 text-xs bg-zinc-700 hover:bg-zinc-600 text-zinc-200
                       rounded transition-colors">
          + Watchlist
        </button>
        <div x-show="showWl" x-transition @click.outside="showWl = false"
             class="absolute z-50 mt-1 right-0 w-40 bg-zinc-800 border border-zinc-700
                    rounded-lg shadow-xl py-1">
          {% for wl in watchlists %}
          <button hx-post="/watchlists/{{ wl.id }}/tickers"
                  hx-vals='{"ticker": "{{ ticker.symbol }}"}'
                  hx-swap="none"
                  @click="showWl = false; showPopover = false"
                  class="w-full text-left px-3 py-1.5 text-xs text-zinc-300 hover:bg-zinc-700
                         hover:text-zinc-100 transition-colors">
            {{ wl.name }}
          </button>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
